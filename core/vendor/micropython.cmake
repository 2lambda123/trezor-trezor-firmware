add_library(micropython
    micropython/extmod/modubinascii.c
    micropython/extmod/moductypes.c
    micropython/extmod/moduheapq.c
    micropython/extmod/modutimeq.c
    micropython/extmod/utime_mphal.c
    micropython/shared/libc/abort_.c
    micropython/shared/libc/printf.c
    micropython/shared/runtime/gchelper_m3.s
    micropython/shared/runtime/gchelper_native.c
    micropython/shared/runtime/interrupt_char.c
    micropython/shared/runtime/pyexec.c
    micropython/shared/runtime/stdout_helpers.c
    micropython/shared/timeutils/timeutils.c
    micropython/ports/stm32/gccollect.c
    micropython/ports/stm32/pendsv.c
    micropython/py/argcheck.c
    micropython/py/asmarm.c
    micropython/py/asmbase.c
    micropython/py/asmthumb.c
    micropython/py/asmx64.c
    micropython/py/asmx86.c
    micropython/py/asmxtensa.c
    micropython/py/bc.c
    micropython/py/binary.c
    micropython/py/builtinevex.c
    micropython/py/builtinhelp.c
    micropython/py/builtinimport.c
    micropython/py/compile.c
    micropython/py/emitbc.c
    micropython/py/emitcommon.c
    micropython/py/emitglue.c
    micropython/py/emitinlinethumb.c
    micropython/py/emitinlinextensa.c
    micropython/py/formatfloat.c
    micropython/py/frozenmod.c
    micropython/py/lexer.c
    micropython/py/malloc.c
    micropython/py/map.c
    micropython/py/modarray.c
    micropython/py/modbuiltins.c
    micropython/py/modgc.c
    micropython/py/modmath.c
    micropython/py/modmicropython.c
    micropython/py/modstruct.c
    micropython/py/modsys.c
    micropython/py/mpprint.c
    micropython/py/mpstate.c
    micropython/py/mpz.c
    micropython/py/nativeglue.c
    micropython/py/obj.c
    micropython/py/objarray.c
    micropython/py/objattrtuple.c
    micropython/py/objbool.c
    micropython/py/objboundmeth.c
    micropython/py/objcell.c
    micropython/py/objclosure.c
    micropython/py/objcomplex.c
    micropython/py/objdict.c
    micropython/py/objenumerate.c
    micropython/py/objexcept.c
    micropython/py/objfilter.c
    micropython/py/objfloat.c
    micropython/py/objfun.c
    micropython/py/objgenerator.c
    micropython/py/objgetitemiter.c
    micropython/py/objint.c
    micropython/py/objint_longlong.c
    micropython/py/objint_mpz.c
    micropython/py/objlist.c
    micropython/py/objmap.c
    micropython/py/objmodule.c
    micropython/py/objnamedtuple.c
    micropython/py/objnone.c
    micropython/py/objobject.c
    micropython/py/objpolyiter.c
    micropython/py/objproperty.c
    micropython/py/objrange.c
    micropython/py/objreversed.c
    micropython/py/objset.c
    micropython/py/objsingleton.c
    micropython/py/objslice.c
    micropython/py/objstr.c
    micropython/py/objstringio.c
    micropython/py/objstrunicode.c
    micropython/py/objtuple.c
    micropython/py/objtype.c
    micropython/py/objzip.c
    micropython/py/opmethods.c
    micropython/py/pairheap.c
    micropython/py/parse.c
    micropython/py/parsenum.c
    micropython/py/parsenumbase.c
    micropython/py/persistentcode.c
    micropython/py/qstr.c
    micropython/py/reader.c
    micropython/py/repl.c
    micropython/py/runtime.c
    micropython/py/runtime_utils.c
    micropython/py/scheduler.c
    micropython/py/scope.c
    micropython/py/sequence.c
    micropython/py/showbc.c
    micropython/py/smallint.c
    micropython/py/stackctrl.c
    micropython/py/stream.c
    micropython/py/unicode.c
    micropython/py/vstr.c
    micropython/py/warning.c
    micropython/py/gc.c
    micropython/py/pystack.c
    micropython/py/vm.c

    micropython/lib/uzlib/adler32.c
    micropython/lib/uzlib/crc32.c
    micropython/lib/uzlib/tinflate.c
)

target_include_directories(micropython PUBLIC micropython)
target_include_directories(micropython PRIVATE ../embed/firmware)

target_link_libraries(micropython PRIVATE trezor-hal)

add_dependencies(micropython qstr)