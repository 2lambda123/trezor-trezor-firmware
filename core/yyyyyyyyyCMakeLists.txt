cmake_minimum_required(VERSION 3.20)
project(core)

set(CMAKE_CXX_STANDARD 14)


add_definitions(
        -DFIRMWARE
        -DTREZOR_MODEL_T
        -DUSE_HAL_DRIVER
        -DUI_LAYOUT_TT
        -DAES_128
        -DAES_192
        -DUSE_BIP32_CACHE=0
        -DUSE_KECCAK=1
        -DUSE_ETHEREUM=1
        -DUSE_MONERO=1
        -DUSE_CARDANO=1
        -DUSE_NEM=1
        -DUSE_EOS=1
        -DUSE_SECP256K1_ZKP
        -DUSE_SECP256K1_ZKP_ECDSA
        -DSECP256K1_CONTEXT_SIZE=180
        -DUSE_ASM_ARM
        -DUSE_EXTERNAL_ASM
        -DUSE_EXTERNAL_DEFAULT_CALLBACKS
        -DECMULT_GEN_PREC_BITS=2
        -DECMULT_WINDOW_SIZE=8
        -DENABLE_MODULE_GENERATOR
        -DENABLE_MODULE_RECOVERY
        -DENABLE_MODULE_SCHNORRSIG
        -DENABLE_MODULE_EXTRAKEYS
        -DTREZOR_UI2
        -DFANCY_FATAL_ERROR
        -DUSE_SVC_SHUTDOWN
        -DRDI
        -DTREZOR_FONT_NORMAL_ENABLE=Font_TTHoves_Regular_21
        -DTREZOR_FONT_NORMAL_INCLUDE="font_tthoves_regular_21.h"
        -DTREZOR_FONT_BOLD_ENABLE=Font_TTHoves_Bold_17
        -DTREZOR_FONT_BOLD_INCLUDE="font_tthoves_bold_17.h"
        -DTREZOR_FONT_DEMIBOLD_ENABLE=Font_TTHoves_DemiBold_21
        -DTREZOR_FONT_DEMIBOLD_INCLUDE="font_tthoves_demibold_21.h"
        -DTREZOR_FONT_MONO_ENABLE=Font_RobotoMono_Medium_20
        -DTREZOR_FONT_MONO_INCLUDE="font_robotomono_medium_20.h"
        -DSTM32_HAL_H=<stm32f4xx.h>
        -DSTM32F427xx
        -DTREZOR_BOARD="boards/trezor_t.h"
        -DHW_MODEL=827601492
        -DHW_REVISION=0
        -DUSE_DMA2D
        -DPRODUCTION=0
        -DBOOTLOADER_QA=0
        -DPYOPT=1
        -DBITCOIN_ONLY=0
)


include_directories(.)
include_directories(embed/rust)
include_directories(embed/firmware)
include_directories(embed/lib)
include_directories(embed/models)
include_directories(embed/trezorhal)
include_directories(embed/extmod/modtrezorui)
include_directories(vendor/micropython)
include_directories(vendor/micropython/lib/cmsis/inc)
include_directories(embed/extmod/modtrezorconfig)
include_directories(vendor/trezor-storage)
include_directories(vendor/trezor-crypto)
include_directories(vendor/secp256k1-zkp)
include_directories(vendor/secp256k1-zkp/src)
include_directories(vendor/secp256k1-zkp/include)
include_directories(vendor/micropython/lib/uzlib)
include_directories(embed/trezorhal/stm32f4)
include_directories(vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Inc)
include_directories(vendor/micropython/lib/stm32lib/CMSIS/STM32F4xx/Include)


add_executable(core
        embed/extmod/modtrezorconfig/modtrezorconfig.c
        vendor/trezor-storage/norcow.c
        vendor/trezor-storage/storage.c
        vendor/trezor-storage/flash_common.c
        embed/extmod/trezorobj.c
        embed/extmod/modtrezorcrypto/crc.c
        embed/extmod/modtrezorcrypto/modtrezorcrypto.c
        embed/extmod/modtrezorcrypto/rand.c
        vendor/trezor-crypto/address.c
        vendor/trezor-crypto/aes/aes_modes.c
        vendor/trezor-crypto/aes/aesccm.c
        vendor/trezor-crypto/aes/aescrypt.c
        vendor/trezor-crypto/aes/aeskey.c
        vendor/trezor-crypto/aes/aestab.c
        vendor/trezor-crypto/base32.c
        vendor/trezor-crypto/base58.c
        vendor/trezor-crypto/bignum.c
        vendor/trezor-crypto/bip32.c
        vendor/trezor-crypto/bip39.c
        vendor/trezor-crypto/bip39_english.c
        vendor/trezor-crypto/blake256.c
        vendor/trezor-crypto/blake2b.c
        vendor/trezor-crypto/blake2s.c
        vendor/trezor-crypto/chacha20poly1305/chacha20poly1305.c
        vendor/trezor-crypto/chacha20poly1305/chacha_merged.c
        vendor/trezor-crypto/chacha20poly1305/poly1305-donna.c
        vendor/trezor-crypto/chacha20poly1305/rfc7539.c
        vendor/trezor-crypto/chacha_drbg.c
        vendor/trezor-crypto/curves.c
        vendor/trezor-crypto/ecdsa.c
        vendor/trezor-crypto/ed25519-donna/curve25519-donna-32bit.c
        vendor/trezor-crypto/ed25519-donna/curve25519-donna-helpers.c
        vendor/trezor-crypto/ed25519-donna/curve25519-donna-scalarmult-base.c
        vendor/trezor-crypto/ed25519-donna/ed25519-donna-32bit-tables.c
        vendor/trezor-crypto/ed25519-donna/ed25519-donna-basepoint-table.c
        vendor/trezor-crypto/ed25519-donna/ed25519-donna-impl-base.c
        vendor/trezor-crypto/ed25519-donna/ed25519-keccak.c
        vendor/trezor-crypto/ed25519-donna/ed25519-sha3.c
        vendor/trezor-crypto/ed25519-donna/ed25519.c
        vendor/trezor-crypto/ed25519-donna/modm-donna-32bit.c
        vendor/trezor-crypto/groestl.c
        vendor/trezor-crypto/hasher.c
        vendor/trezor-crypto/hmac.c
        vendor/trezor-crypto/hmac_drbg.c
        vendor/trezor-crypto/memzero.c
        vendor/trezor-crypto/nem.c
        vendor/trezor-crypto/nist256p1.c
        vendor/trezor-crypto/pbkdf2.c
        vendor/trezor-crypto/rand.c
        vendor/trezor-crypto/rfc6979.c
        vendor/trezor-crypto/ripemd160.c
        vendor/trezor-crypto/secp256k1.c
        vendor/trezor-crypto/segwit_addr.c
        vendor/trezor-crypto/sha2.c
        vendor/trezor-crypto/sha3.c
        vendor/trezor-crypto/shamir.c
        vendor/trezor-crypto/slip39.c
        vendor/trezor-crypto/slip39_english.c
        vendor/trezor-crypto/tls_prf.c
        vendor/trezor-crypto/cardano.c
        vendor/trezor-crypto/monero/base58.c
        vendor/trezor-crypto/monero/serialize.c
        vendor/trezor-crypto/monero/xmr.c
        vendor/trezor-crypto/zkp_context.c
        vendor/trezor-crypto/zkp_ecdsa.c
        vendor/trezor-crypto/zkp_bip340.c
        embed/extmod/modtrezorio/modtrezorio.c
        embed/lib/mini_printf.c
        embed/lib/unit_variant.c
        embed/lib/buffers.c
        embed/lib/colors.c
        embed/lib/display.c
        embed/lib/fonts/fonts.c
        embed/lib/fonts/font_bitmap.c
        embed/lib/image.c
        embed/extmod/modtrezorui/modtrezorui.c
        vendor/micropython/lib/uzlib/adler32.c
        vendor/micropython/lib/uzlib/crc32.c
        vendor/micropython/lib/uzlib/tinflate.c
        embed/extmod/modtrezorutils/modtrezorutils.c
        embed/extmod/rustmods.c
        embed/extmod/modutime.c
        embed/lib/fonts/font_tthoves_regular_21.c
        embed/lib/fonts/font_tthoves_bold_17.c
        embed/lib/fonts/font_tthoves_demibold_21.c
        embed/lib/fonts/font_robotomono_medium_20.c
        embed/firmware/bl_check.c
        embed/firmware/delay.c
        embed/firmware/header.S
        embed/firmware/main.c
        embed/firmware/mphalport.c
        embed/firmware/nlrthumb.c
        embed/firmware/startup.S
        vendor/micropython/extmod/modubinascii.c
        vendor/micropython/extmod/moductypes.c
        vendor/micropython/extmod/moduheapq.c
        vendor/micropython/extmod/modutimeq.c
        vendor/micropython/extmod/utime_mphal.c
        vendor/micropython/shared/libc/abort_.c
        vendor/micropython/shared/libc/printf.c
        vendor/micropython/shared/runtime/gchelper_m3.s
        vendor/micropython/shared/runtime/gchelper_native.c
        vendor/micropython/shared/runtime/interrupt_char.c
        vendor/micropython/shared/runtime/pyexec.c
        vendor/micropython/shared/runtime/stdout_helpers.c
        vendor/micropython/shared/timeutils/timeutils.c
        vendor/micropython/ports/stm32/gccollect.c
        vendor/micropython/ports/stm32/pendsv.c
        vendor/micropython/py/argcheck.c
        vendor/micropython/py/asmarm.c
        vendor/micropython/py/asmbase.c
        vendor/micropython/py/asmthumb.c
        vendor/micropython/py/asmx64.c
        vendor/micropython/py/asmx86.c
        vendor/micropython/py/asmxtensa.c
        vendor/micropython/py/bc.c
        vendor/micropython/py/binary.c
        vendor/micropython/py/builtinevex.c
        vendor/micropython/py/builtinhelp.c
        vendor/micropython/py/builtinimport.c
        vendor/micropython/py/compile.c
        vendor/micropython/py/emitbc.c
        vendor/micropython/py/emitcommon.c
        vendor/micropython/py/emitglue.c
        vendor/micropython/py/emitinlinethumb.c
        vendor/micropython/py/emitinlinextensa.c
        vendor/micropython/py/formatfloat.c
        vendor/micropython/py/frozenmod.c
        vendor/micropython/py/lexer.c
        vendor/micropython/py/malloc.c
        vendor/micropython/py/map.c
        vendor/micropython/py/modarray.c
        vendor/micropython/py/modbuiltins.c
        vendor/micropython/py/modgc.c
        vendor/micropython/py/modmath.c
        vendor/micropython/py/modmicropython.c
        vendor/micropython/py/modstruct.c
        vendor/micropython/py/modsys.c
        vendor/micropython/py/mpprint.c
        vendor/micropython/py/mpstate.c
        vendor/micropython/py/mpz.c
        vendor/micropython/py/nativeglue.c
        vendor/micropython/py/obj.c
        vendor/micropython/py/objarray.c
        vendor/micropython/py/objattrtuple.c
        vendor/micropython/py/objbool.c
        vendor/micropython/py/objboundmeth.c
        vendor/micropython/py/objcell.c
        vendor/micropython/py/objclosure.c
        vendor/micropython/py/objcomplex.c
        vendor/micropython/py/objdict.c
        vendor/micropython/py/objenumerate.c
        vendor/micropython/py/objexcept.c
        vendor/micropython/py/objfilter.c
        vendor/micropython/py/objfloat.c
        vendor/micropython/py/objfun.c
        vendor/micropython/py/objgenerator.c
        vendor/micropython/py/objgetitemiter.c
        vendor/micropython/py/objint.c
        vendor/micropython/py/objint_longlong.c
        vendor/micropython/py/objint_mpz.c
        vendor/micropython/py/objlist.c
        vendor/micropython/py/objmap.c
        vendor/micropython/py/objmodule.c
        vendor/micropython/py/objnamedtuple.c
        vendor/micropython/py/objnone.c
        vendor/micropython/py/objobject.c
        vendor/micropython/py/objpolyiter.c
        vendor/micropython/py/objproperty.c
        vendor/micropython/py/objrange.c
        vendor/micropython/py/objreversed.c
        vendor/micropython/py/objset.c
        vendor/micropython/py/objsingleton.c
        vendor/micropython/py/objslice.c
        vendor/micropython/py/objstr.c
        vendor/micropython/py/objstringio.c
        vendor/micropython/py/objstrunicode.c
        vendor/micropython/py/objtuple.c
        vendor/micropython/py/objtype.c
        vendor/micropython/py/objzip.c
        vendor/micropython/py/opmethods.c
        vendor/micropython/py/pairheap.c
        vendor/micropython/py/parse.c
        vendor/micropython/py/parsenum.c
        vendor/micropython/py/parsenumbase.c
        vendor/micropython/py/persistentcode.c
        vendor/micropython/py/qstr.c
        vendor/micropython/py/reader.c
        vendor/micropython/py/repl.c
        vendor/micropython/py/runtime.c
        vendor/micropython/py/runtime_utils.c
        vendor/micropython/py/scheduler.c
        vendor/micropython/py/scope.c
        vendor/micropython/py/sequence.c
        vendor/micropython/py/showbc.c
        vendor/micropython/py/smallint.c
        vendor/micropython/py/stackctrl.c
        vendor/micropython/py/stream.c
        vendor/micropython/py/unicode.c
        vendor/micropython/py/vstr.c
        vendor/micropython/py/warning.c
        vendor/micropython/py/gc.c
        vendor/micropython/py/pystack.c
        vendor/micropython/py/vm.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_cortex.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_flash.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_flash_ex.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_gpio.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_i2c.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_ltdc.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_pcd.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_pcd_ex.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_pwr.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_rcc.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_rcc_ex.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_sd.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_spi.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_sram.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_sdram.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_tim.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_tim_ex.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_ll_fmc.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_ll_sdmmc.c
        embed/trezorhal/stm32f4/board_capabilities.c
        embed/trezorhal/stm32f4/common.c
        embed/trezorhal/stm32f4/flash.c
        embed/trezorhal/stm32f4/lowlevel.c
        embed/trezorhal/stm32f4/mpu.c
        embed/trezorhal/stm32f4/platform.c
        embed/trezorhal/stm32f4/systick.c
        embed/trezorhal/stm32f4/random_delays.c
        embed/trezorhal/stm32f4/rng.c
        embed/trezorhal/stm32f4/vectortable.s
        embed/trezorhal/stm32f4/util.s
        embed/models/model_T2T1_layout.c
        embed/trezorhal/stm32f4/displays/st7789v.c
        embed/trezorhal/stm32f4/backlight_pwm.c
        embed/trezorhal/stm32f4/displays/panels/tf15411a.c
        embed/trezorhal/stm32f4/displays/panels/154a.c
        embed/trezorhal/stm32f4/displays/panels/lx154a2411.c
        embed/trezorhal/stm32f4/displays/panels/lx154a2422.c
        embed/trezorhal/stm32f4/i2c.c
        embed/trezorhal/stm32f4/touch/ft6x36.c
        embed/lib/touch.c
        embed/trezorhal/stm32f4/sdcard.c
        embed/extmod/modtrezorio/ff.c
        embed/extmod/modtrezorio/ffunicode.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_dma.c
        embed/trezorhal/stm32f4/sbu.c
        embed/trezorhal/stm32f4/usb.c
        embed/trezorhal/stm32f4/usbd_conf.c
        embed/trezorhal/stm32f4/usbd_core.c
        embed/trezorhal/stm32f4/usbd_ctlreq.c
        embed/trezorhal/stm32f4/usbd_ioreq.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_ll_usb.c
        embed/trezorhal/stm32f4/dma2d.c
        vendor/micropython/lib/stm32lib/STM32F4xx_HAL_Driver/Src/stm32f4xx_hal_dma2d.c
        vendor/secp256k1-zkp/src/secp256k1.c
        vendor/secp256k1-zkp/src/precomputed_ecmult.c
        vendor/secp256k1-zkp/src/precomputed_ecmult_gen.c
        vendor/secp256k1-zkp/src/asm/field_10x26_arm.s
)

